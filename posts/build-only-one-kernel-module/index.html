<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><link rel="icon" href="/favicon.png"><!-- <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"> --><!--SEO_BEGIN--><!-- Begin Jekyll SEO tag v2.7.1 --><title>Linux Kernel 只编译一个module | ccat3z.xyz</title><meta name="generator" content="Jekyll v4.2.0"/><meta property="og:title" content="Linux Kernel 只编译一个module"/><meta name="author" content="ccat3z"/><meta property="og:locale" content="en_US"/><meta name="description" content="这企鹅好逗"/><meta property="og:description" content="这企鹅好逗"/><link rel="canonical" href="//ccat3z.xyz/posts/build-only-one-kernel-module/"/><meta property="og:url" content="//ccat3z.xyz/posts/build-only-one-kernel-module/"/><meta property="og:site_name" content="ccat3z.xyz"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2017-02-03T10:20:06+08:00"/><meta name="twitter:card" content="summary"/><meta property="twitter:title" content="Linux Kernel 只编译一个module"/><script type="application/ld+json">{"@type":"BlogPosting","headline":"Linux Kernel 只编译一个module","dateModified":"2017-02-03T10:20:06+08:00","datePublished":"2017-02-03T10:20:06+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"//ccat3z.xyz/posts/build-only-one-kernel-module/"},"author":{"@type":"Person","name":"ccat3z"},"description":"这企鹅好逗","url":"//ccat3z.xyz/posts/build-only-one-kernel-module/","@context":"https://schema.org"}</script><!-- End Jekyll SEO tag --><!--SEO_END--><link href="/static/css/main.bfbb22e1.chunk.css" rel="stylesheet"></head><body><div id="blog"></div><div id="blog-data"><div id="blog-data-content"><div class="post"><div class="post-info"><span class="post-id">/posts/build-only-one-kernel-module</span> <a href="/posts/build-only-one-kernel-module/" class="post-title">Linux Kernel 只编译一个module </a><span class="post-date">03 Feb 2017</span><p class="post-description">这企鹅好逗</p><ul class="post-tags"><li><a href="/tag/linux/" class="post-tag">Linux</a></li></ul></div><div class="content"><p>调试编译Linux Kernel有时会遇到这种情况, 辛辛苦苦编译了大半天却发现忘了个module. 然而Linux可插拔的module设计能够让我们单独编译单个module, 为我们节省了不少时间.</p><p>以linux-surfacepro3的cpufreq_stats为例: (linux 4.8之后cpufreq_stats不再以module形式加载)</p><p>以内核root目录为work dir</p><p>确保work dir下存在<code class="language-plaintext highlighter-rouge">Module.symvers</code>, 没有的话到<code class="language-plaintext highlighter-rouge">/lib/modules/${KERNEL}/build/Module.symvers</code></p><p>将kernel config复制到<code class="language-plaintext highlighter-rouge">.config</code></p><p>准备工作:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make prepare
make scripts
</code></pre></div></div><p>先找到模块的位置: <code class="language-plaintext highlighter-rouge">drivers/cpufreq</code></p><p>以及模块的配置参数: <code class="language-plaintext highlighter-rouge">CONFIG_CPU_FREQ_STAT=m</code></p><p>在kernel根目录下编译: <code class="language-plaintext highlighter-rouge">make CONFIG_CPU_FREQ_STAT=m M=drivers/cpufreq modules</code></p><p>看make的输出找到生成module的位置并复制到module目录里: <code class="language-plaintext highlighter-rouge">sudo cp drivers/cpufreq/cpufreq_stats.ko /lib/modules/${KERNEL}/kernel/drivers/cpufreq/</code></p><p>最后再用<code class="language-plaintext highlighter-rouge">insmod</code>或者<code class="language-plaintext highlighter-rouge">depmod</code>生效即可</p></div></div></div><div id="blog-data-page-pagination"></div><div id="blog-data-nav"><ul><li><a href="/" class="icon-home">home</a></li><li><a href="/posts/" class="icon-create">post</a></li><li><a href="/love/" class="icon-favorite">love</a></li></ul></div></div><script src="/static/js/runtime-main.26ceb475.js"></script><script src="/static/js/2.4c4b9d9d.chunk.js"></script><script src="/static/js/main.e5921d51.chunk.js"></script></body></html>