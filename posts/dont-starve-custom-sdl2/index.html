<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title id="site-title">饥荒系列自定义SDL2 | ccat3z's blog</title><link rel="icon" href="/favicon.png"><title>饥荒系列自定义SDL2 | ccat3z’s blog</title><meta name="generator" content="Jekyll v3.8.5"><meta property="og:title" content="饥荒系列自定义SDL2"><meta name="author" content="ccat3z"><meta property="og:locale" content="en_US"><meta name="description" content="转自 Klei Forums"><meta property="og:description" content="转自 Klei Forums"><link rel="canonical" href="//ccat3z.xyz/posts/dont-starve-custom-sdl2/"><meta property="og:url" content="//ccat3z.xyz/posts/dont-starve-custom-sdl2/"><meta property="og:site_name" content="ccat3z’s blog"><meta property="og:image" content="//ccat3z.xyz/images/2018-10-22-dont-starve-custom-sdl2/image.jpg"><meta property="og:type" content="article"><meta property="article:published_time" content="2018-10-22T20:57:29+08:00"><script type="application/ld+json">{"description":"转自 Klei Forums","@type":"BlogPosting","url":"//ccat3z.xyz/posts/dont-starve-custom-sdl2/","headline":"饥荒系列自定义SDL2","dateModified":"2018-10-22T20:57:29+08:00","datePublished":"2018-10-22T20:57:29+08:00","image":"//ccat3z.xyz/images/2018-10-22-dont-starve-custom-sdl2/image.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"//ccat3z.xyz/posts/dont-starve-custom-sdl2/"},"author":{"@type":"Person","name":"ccat3z"},"@context":"http://schema.org"}</script><link href="https://cdn.bootcss.com/material-design-icons/3.0.1/iconfont/material-icons.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/vuetify@1.5.5/dist/vuetify.min.css" rel="stylesheet"><link href="/css/blog.820ce6f1af5b0b5518ca.css" rel="stylesheet"></head><body><div id="blog"></div><div id="blog-data"><div id="blog-data-content"><div class="post"><div class="post-info"><a href="/posts/dont-starve-custom-sdl2/" class="post-title">饥荒系列自定义SDL2 </a><span class="post-date">22 Oct 2018</span><p class="post-short-description">玩到可持续发展</p><ul class="post-tags"><li><a href="/tag/game" class="post-tag">Game</a></li></ul><img class="post-image" src="/images/2018-10-22-dont-starve-custom-sdl2/image.jpg"></div><div class="content"><blockquote><p>转自 <a href="https://forums.kleientertainment.com/forums/topic/30218-crash-on-linux-steam-without-error/?do=findComment&amp;comment=387425">Klei Forums</a></p></blockquote><p>玩饥荒的时候发现一个问题, 在Linux下不支持IME. 猜了下估计是饥荒内置sdl2库版本太低还不支持IME, (Arch Linux官方repo里的SDL2也因为编译时没开IME支持导致一些SDL2应用没法使用输入法). 编译了一个发现鼠标不能用了… 在Klei论坛找了很久发现有人逆向后发现饥荒修改了SDL2库里mouse event的结构体. 我转来备份一下修改方法(主要是第3 - 8步). 我自己修改后支持IME的sdl2.0.4库可以在<a href="https://mega.nz/#!1gIXCaBb!MGLQfMJEcX3sAoAyo-K6SCochTMmSEBa4Dqa7D8D3Bk">这里</a>下载.</p><p>以下是原贴</p><p>Well if it crashes for you because the included libSDL2 won’t work with your graphics drivers then maybe you could fix the issue by compiling your own SDL2. Here’s how (this assumes 64 bit linux and steam version of the game):</p><ol><li><p>​Download libsdl2 from www.libsdl2.org</p></li><li><p>unpack it</p></li><li><p>open <code class="highlighter-rouge">&lt;SDL2 root&gt;/include/SDL_events.h</code></p></li><li>go to line 218, look at the lines till line 259 and whenever you encounter this line:<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">Uint32</span> <span class="n">which</span><span class="p">;</span>       <span class="cm">/**&lt; The mouse instance id, or SDL_TOUCH_MOUSEID */</span>
</code></pre></div></div><p>​delete it</p></li><li><p>Save the file</p></li><li><p>open <code class="highlighter-rouge">&lt;SDL2 root&gt;/src/events/SDL_mouse.c</code></p></li><li>go to line 261, look at the lines till line 316 and whenever you encounter any of these lines:<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">event</span><span class="p">.</span><span class="n">motion</span><span class="p">.</span><span class="n">which</span> <span class="o">=</span> <span class="n">mouseID</span><span class="p">;</span>
  <span class="n">event</span><span class="p">.</span><span class="n">button</span><span class="p">.</span><span class="n">which</span> <span class="o">=</span> <span class="n">mouseID</span><span class="p">;</span>
  <span class="n">event</span><span class="p">.</span><span class="n">wheel</span><span class="p">.</span><span class="n">which</span> <span class="o">=</span> <span class="n">mouseID</span><span class="p">;</span>
</code></pre></div></div><p>​delete it</p></li><li><p>Save the file</p></li><li><p>go to the SDL2 root</p></li><li>run in terminal from the SDL2 root:<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ./configure <span class="nt">--prefix</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/output <span class="nt">--host</span><span class="o">=</span>i686-linux-gnu <span class="s2">"CFLAGS=-m32"</span> <span class="s2">"CXXFLAGS=-m32"</span> <span class="s2">"LDFLAGS=-m32"</span>
  make <span class="nt">-j9</span>
  make <span class="nb">install
  mkdir</span> ~/.local/share/Steam/SteamApps/common/dont_starve/bin/lib32/backup
  <span class="nb">mv</span> ~/.local/share/Steam/SteamApps/common/dont_starve/bin/lib32/libSDL2<span class="k">*</span>so<span class="k">*</span> ~/.local/share/Steam/SteamApps/common/dont_starve/bin/lib32/backup/
  <span class="nb">cp </span>output/lib/libSDL2<span class="k">*</span>so<span class="k">*</span> ~/.local/share/Steam/SteamApps/common/dont_starve/bin/lib32/
</code></pre></div></div></li><li>I don’t know what distro you’re on but you’ll need to install some dependencies of SDL2 as well as tools to build libraries, if you’re on ubuntu, look here under “build dependencies” there’s a list of stuff you need and I think<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>apt-get build-dep libsdl2
</code></pre></div></div><p>will automatically install them. After you’re done try if your game works, if it does - woohoo - we both had the same problem. If it doesn’t, run</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">cp</span> ~/.local/share/Steam/SteamApps/common/dont_starve/bin/lib32/backup/<span class="k">*</span> ~/.local/share/Steam/SteamApps/common/dont_starve/bin/lib32/
  <span class="nb">rm</span> <span class="nt">-r</span> ~/.local/share/Steam/SteamApps/common/dont_starve/bin/lib32/backup
</code></pre></div></div><p>to restore the original libSDL2 files.</p></li></ol><p>​I’m not sure this is very healthy advice though. It’s probably an overcomplicated solution for a simple problem… Also - I skimmed through your previous posts and it seems your game segfaults only AFTER it has initialized GL, so I have no Idea if this will help.</p></div></div></div><div id="blog-data-page-pagination"></div><div id="blog-data-nav"><ul><li><a href="/" class="icon-home">home</a></li><li><a href="/posts/" class="icon-create">post</a></li><li><a href="/projects/" class="icon-code">projects</a></li><li><a href="/tags/" class="icon-bookmark">tags</a></li><li><a href="/love/" class="icon-favorite">love</a></li></ul></div></div><script src="https://cdn.jsdelivr.net/npm/@babel/polyfill@7.2.5/dist/polyfill.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.8/dist/vue.runtime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vuetify@1.5.5/dist/vuetify.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="/js/blog.820ce6f1af5b0b5518ca.js"></script></body></html>