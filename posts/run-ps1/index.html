<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title id="site-title">PowerShell让系统可以执行.ps1文件 | ccat3z's blog</title><link rel="icon" href="/favicon.png"><title>PowerShell让系统可以执行.ps1文件 | ccat3z’s blog</title><meta name="generator" content="Jekyll v4.1.1"/><meta property="og:title" content="PowerShell让系统可以执行.ps1文件"/><meta name="author" content="ccat3z"/><meta property="og:locale" content="en_US"/><meta name="description" content="转载自PowerShell让系统可以执行.ps1文件"/><meta property="og:description" content="转载自PowerShell让系统可以执行.ps1文件"/><link rel="canonical" href="//ccat3z.xyz/posts/run-ps1/"/><meta property="og:url" content="//ccat3z.xyz/posts/run-ps1/"/><meta property="og:site_name" content="ccat3z’s blog"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2017-03-30T23:28:09+08:00"/><script type="application/ld+json">{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"//ccat3z.xyz/posts/run-ps1/"},"author":{"@type":"Person","name":"ccat3z"},"headline":"PowerShell让系统可以执行.ps1文件","dateModified":"2017-03-30T23:28:09+08:00","datePublished":"2017-03-30T23:28:09+08:00","description":"转载自PowerShell让系统可以执行.ps1文件","url":"//ccat3z.xyz/posts/run-ps1/","@context":"https://schema.org"}</script><link href="/static/css/main.2084baca.chunk.css" rel="stylesheet"></head><body><div id="blog"></div><div id="blog-data"><div id="blog-data-content"><div class="post"><div class="post-info"><a href="/posts/run-ps1/" class="post-title">PowerShell让系统可以执行.ps1文件 </a><span class="post-date">30 Mar 2017</span><p class="post-short-description">转载自PowerShell让系统可以执行.ps1文件</p><ul class="post-tags"><li><a href="/tag/windows" class="post-tag">Windows</a></li></ul></div><div class="content"><blockquote><p>转载自<a href="http://www.splaybow.com/post/powershellexecps1.html">PowerShell让系统可以执行.ps1文件</a></p></blockquote><p>.ps1文件是PowerShell写好的脚本文件。在Windows系统中，默认情况下是不允许执行.ps1文件的，那么怎么才能让系统允许执行.ps1文件呢？</p><h1 id="什么是ps1文件">什么是<code class="language-plaintext highlighter-rouge">.ps1</code>文件？</h1><p>这个是PowerShell写的脚本文本，你可以在记事本中写一段PowerShell代码，然后将其保存为“xxx.ps1”，后面要使用它的时候，双击即可运行了。这有点像批处理的“.bat”文件，也有点像VBScript的“.vbs”文件。这些都是Windows的脚本文件。</p><h1 id="如何执行ps1文件">如何执行<code class="language-plaintext highlighter-rouge">.ps1</code>文件？</h1><p>接下来大家会问，那我们就双击它运行好了，还有什么好说的吗？当然要说。我们想得很美，双击一下就执行了，但是Windows系统默认是不允许执行.ps1文件的，所以你得往下看。</p><h1 id="执行不成功的解决办法">执行不成功的解决办法</h1><ol><li>将PowerShell的脚本内容保存到一个.ps1为后缀的文件中。</li><li>双击执行此ps1文件很有可能无法执行，提示：无法加载文件 D:\PowerShell\test\myfirst1.ps1，因为在此系统中禁止执行脚本。</li><li>运行get-executionpolicy，如果结果是Restricted，那表示禁止执行脚本。</li><li>执行如下命令，降低系统的安全性，允许执行脚本：<code class="language-plaintext highlighter-rouge">set-executionpolicy -executionpolicy unrestricted</code></li></ol><h1 id="关于执行策略">关于执行策略</h1><p>这里有一个executionpolicy，翻译过来就是执行策略。Windows对PowerShell脚本默认的执行策略是：不允许执行，即Restricted。把它改成unrestricted自然就可以执行了。但微软给出的Best Practise（“最佳实践”）是RemoteSigned，这个级别比UnRestricted要高一点，不是什么程序都能执行。据我简单的了解，RemoteSigned是要求远程下载的ps1脚本文件必须是签名的才可以执行。至于我们在本机上自写的脚本程序，那是没有区别，都可以执行的。</p><h1 id="修改执行策略需要权限">修改执行策略需要权限</h1><p>另外需要说明的是，如果是在Win7、Win8、Windows 2008、Windows 2012等系统上，且不是使用administrator账号来执行这个set-executionpolicy语句，将会报错，错误如下： Set-ExecutionPolicy : 对注册表项<span style="word-break:break-all">KEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PowerShell\1\ShellIds\Microsoft.PowerShell</span>的访问被拒绝。 账号虽然不是administrator，但也是administrators组的，为什么会没有权限呢？不管了，在注册表中，找到这个键，然后点右键选择“权限”，然后给当前登录系统的账号加一个“完全控制”的权限（只有“只读”和“完全控制”两个权限，所以就选“完全控制”了）。然后，再重新执行<code class="language-plaintext highlighter-rouge">set-executionpolicy -executionpolicy unrestricted</code>，就可以成功了！</p></div></div></div><div id="blog-data-page-pagination"></div><div id="blog-data-nav"><ul><li><a href="/" class="icon-home">home</a></li><li><a href="/posts/" class="icon-create">post</a></li><li><a href="/love/" class="icon-favorite">love</a></li></ul></div></div><script src="/static/js/runtime-main.89ca9b38.js"></script><script src="/static/js/2.61bbcaed.chunk.js"></script><script src="/static/js/main.0983d4cc.chunk.js"></script></body></html>