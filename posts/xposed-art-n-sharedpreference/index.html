<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title id="site-title">Xposedåœ¨Android Nä¸‹å°è¯•ä½¿ç”¨SharedPreferenceçš„è§£å†³æ–¹æ¡ˆ | c0ldcat's blog</title> <link rel="icon" href="/c0ldcat.png"> <link rel="stylesheet" type="text/css" href="/css/main.css"> <link rel="alternate" type="application/rss+xml" title="RSS Feed for c0ldcat's blog" href="/feed.xml" /> <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script> <script type="text/javascript" src="/js/jquery.typetype.min.js"></script> <script> var _hmt = _hmt || []; (function () { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?e1acee033923881f5528a3b4a658039b"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> <style> .block-left { background-size: cover; background-position-x: right; } </style> <!-- Begin Jekyll SEO tag v2.5.0 --> <title>Xposedåœ¨Android Nä¸‹å°è¯•ä½¿ç”¨SharedPreferenceçš„è§£å†³æ–¹æ¡ˆ | c0ldcatâ€™s blog</title> <meta name="generator" content="Jekyll v3.8.3" /> <meta property="og:title" content="Xposedåœ¨Android Nä¸‹å°è¯•ä½¿ç”¨SharedPreferenceçš„è§£å†³æ–¹æ¡ˆ" /> <meta name="author" content="c0ldcat" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="æœ€è¿‘æœ‰å¼€å‘è€…ç»ˆäºè€ä¸ä½ç­‰å¾…, æ‹¿èµ·artçš„æºç å°±å¼€å§‹è‡ªå·±æ”¹. è™½ç„¶åªæ˜¯WIP, ä½†å„è·¯å¤§ç¥ç«‹åˆ»å°±æ”¾å‡ºäº†å¡åˆ·åŒ…, æˆ‘ä¹Ÿè¿«ä¸åŠå¾…å¾—å°äº†æŠŠé²œ. ä¸è¿‡å¾ˆå¿«å°±å‘ç°åŸæ¥çš„SharedPreferenceå·²ç»ä¸å†é€‚ç”¨, è¿™é‡Œç®€å•ä»‹ç»ä¸‹æˆ‘æ‰€ä½¿ç”¨çš„è§£å†³æ–¹æ³•." /> <meta property="og:description" content="æœ€è¿‘æœ‰å¼€å‘è€…ç»ˆäºè€ä¸ä½ç­‰å¾…, æ‹¿èµ·artçš„æºç å°±å¼€å§‹è‡ªå·±æ”¹. è™½ç„¶åªæ˜¯WIP, ä½†å„è·¯å¤§ç¥ç«‹åˆ»å°±æ”¾å‡ºäº†å¡åˆ·åŒ…, æˆ‘ä¹Ÿè¿«ä¸åŠå¾…å¾—å°äº†æŠŠé²œ. ä¸è¿‡å¾ˆå¿«å°±å‘ç°åŸæ¥çš„SharedPreferenceå·²ç»ä¸å†é€‚ç”¨, è¿™é‡Œç®€å•ä»‹ç»ä¸‹æˆ‘æ‰€ä½¿ç”¨çš„è§£å†³æ–¹æ³•." /> <link rel="canonical" href="//blog.c0ldcat.ml/posts/xposed-art-n-sharedpreference/" /> <meta property="og:url" content="//blog.c0ldcat.ml/posts/xposed-art-n-sharedpreference/" /> <meta property="og:site_name" content="c0ldcatâ€™s blog" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2017-07-24T23:07:39+08:00" /> <script type="application/ld+json"> {"@type":"BlogPosting","url":"//blog.c0ldcat.ml/posts/xposed-art-n-sharedpreference/","headline":"Xposedåœ¨Android Nä¸‹å°è¯•ä½¿ç”¨SharedPreferenceçš„è§£å†³æ–¹æ¡ˆ","dateModified":"2017-07-24T23:07:39+08:00","datePublished":"2017-07-24T23:07:39+08:00","author":{"@type":"Person","name":"c0ldcat"},"description":"æœ€è¿‘æœ‰å¼€å‘è€…ç»ˆäºè€ä¸ä½ç­‰å¾…, æ‹¿èµ·artçš„æºç å°±å¼€å§‹è‡ªå·±æ”¹. è™½ç„¶åªæ˜¯WIP, ä½†å„è·¯å¤§ç¥ç«‹åˆ»å°±æ”¾å‡ºäº†å¡åˆ·åŒ…, æˆ‘ä¹Ÿè¿«ä¸åŠå¾…å¾—å°äº†æŠŠé²œ. ä¸è¿‡å¾ˆå¿«å°±å‘ç°åŸæ¥çš„SharedPreferenceå·²ç»ä¸å†é€‚ç”¨, è¿™é‡Œç®€å•ä»‹ç»ä¸‹æˆ‘æ‰€ä½¿ç”¨çš„è§£å†³æ–¹æ³•.","mainEntityOfPage":{"@type":"WebPage","@id":"//blog.c0ldcat.ml/posts/xposed-art-n-sharedpreference/"},"@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="block-left"> <div class="content"> <div class="main-info"> <a href="/" class="logo"><img src="/images/c0ldcat-pure-white.svg" class="logo"></a> <h1> <span id="author-name">c0ldcat</span><span>&#39;s blog</span> </h1> <ul> <li><a href="/posts" class="emoji-nav">ğŸ–Šï¸</a></li> <li><a href="/projects" class="emoji-nav">ğŸˆ</a></li> <li><a href="/tags" class="emoji-nav">ğŸ”–</a></li> <li><a href="/love" class="emoji-nav">â¤ï¸</a></li> </ul> </div> </div> <canvas></canvas> </div> <div id="pages" class="block-right"> <div class="inner-post content"> <h1>Xposedåœ¨Android Nä¸‹å°è¯•ä½¿ç”¨SharedPreferenceçš„è§£å†³æ–¹æ¡ˆ</h1> <div class="date-highlight">24 Jul 2017</div> <p>æœ€è¿‘æœ‰å¼€å‘è€…ç»ˆäºè€ä¸ä½ç­‰å¾…, æ‹¿èµ·artçš„æºç å°±å¼€å§‹è‡ªå·±æ”¹. è™½ç„¶åªæ˜¯WIP, ä½†å„è·¯å¤§ç¥ç«‹åˆ»å°±æ”¾å‡ºäº†å¡åˆ·åŒ…, æˆ‘ä¹Ÿè¿«ä¸åŠå¾…å¾—å°äº†æŠŠé²œ. ä¸è¿‡å¾ˆå¿«å°±å‘ç°åŸæ¥çš„SharedPreferenceå·²ç»ä¸å†é€‚ç”¨, è¿™é‡Œç®€å•ä»‹ç»ä¸‹æˆ‘æ‰€ä½¿ç”¨çš„è§£å†³æ–¹æ³•.</p> <p>æˆ‘ä»¬çŸ¥é“, Xposedæ˜¯é€šè¿‡å‘ç›®æ ‡apk"æ³¨å…¥"ç‰‡æ®µæ¥å®ç°ä¿®æ”¹åŸç¨‹åºåŠŸèƒ½çš„, å®é™…è¿è¡Œæ—¶æ˜¯åœ¨ç›®æ ‡apkä¸‹. é€šå¸¸æˆ‘ä»¬æƒ³é€šè¿‡appæ¥æ§åˆ¶ä¸€äº›Xposedæ’ä»¶çš„åŠŸèƒ½, ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ–¹ä¾¿çš„å·¥å…·å°±æ˜¯SharedPreference, ä½†Androidä¸­, æ¯ä¸ªapkéƒ½å¤„äºä¸åŒçš„ç”¨æˆ·ä¸‹è¿è¡Œ, ä¸èƒ½ç›´æ¥XSharedPreferenceè·å–å¯¹åº”è®¾ç½®. åœ¨ä¹‹å‰çš„Androidç‰ˆæœ¬ä¸­æˆ‘ä»¬å¸¸å¸¸é€šè¿‡å°†SharedPreferenceè®¾ç½®ä¸º<code class="highlighter-rouge">MODE_WORLD_READABLE</code>æ¥å®ç°å…¨ç”¨æˆ·å¯è¯»:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">getPreferenceManager</span><span class="o">().</span><span class="na">setSharedPreferencesMode</span><span class="o">(</span><span class="n">MODE_WORLD_READABLE</span><span class="o">);</span>
</code></pre></div></div> <p>åœ¨xposed hookæ®µä¸­ä½¿ç”¨:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">XSharedPreferences</span> <span class="n">xSharedPreferences</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XSharedPreferences</span><span class="o">(</span><span class="n">PACKAGE_NAME</span><span class="o">);</span>
<span class="n">xSharedPreferences</span><span class="o">.</span><span class="na">makeWorldReadable</span><span class="o">();</span>
</code></pre></div></div> <p>ä½†åœ¨Nä¸­è¿™ä¸ªå‚æ•°å·²ç»è¢«ç¦ç”¨äº†(no longer supported), (Mä¸­æ˜¯ä¸æ¨è(deprecated)). ä¸è¿‡æˆ‘ä»¬çš„æƒ³æ³•å¤§ä½“ä¸Šæ˜¯ä¸å˜çš„, ç›´æ¥æ‰¾SharedPreferenceçš„xmlæ–‡ä»¶å¹¶å…¨ç”¨æˆ·(ç»„)Readable, ä»¥PreferenceFragmentä¸ºä¾‹, åœ¨onPauseä¸­æ’å…¥:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// æ”¾åœ¨super.onPause();ä¹‹å</span>
<span class="c1">// å› ä¸ºPreferenceFragmenté»˜è®¤é‡‡ç”¨çš„æ˜¯MODE_PRIVATE</span>
<span class="c1">// æˆ–è€…getActivity().getApplicationInfo().dataDir + "/shared_prefs/"</span>
<span class="c1">//         + getPreferenceManager().getSharedPreferencesName() + ".xml"</span>
<span class="c1">// å½“ç„¶ä¼šè¢«IDEè­¦å‘Š, å½“ç„¶åˆ«å¿˜äº†æµ‹è¯•file exist</span>
<span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/data/data/"</span> <span class="o">+</span> <span class="n">PACKAGE_NAME</span> <span class="o">+</span> <span class="s">"/shared_prefs/"</span> <span class="o">+</span> <span class="n">PACKAGE_NAME</span> <span class="o">+</span> <span class="s">"_preferences.xml"</span><span class="o">).</span><span class="na">setReadable</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</code></pre></div></div> <p>è™½ç„¶è§£å†³äº†<code class="highlighter-rouge">MODE_WORLD_READABLE</code>, ä¸è¿‡è¿™æ ·åœ¨Nä¸­è¿˜æ˜¯å¯èƒ½ä¼šæ— æ³•å·¥ä½œ. åœ¨UNIXå…¶ä»–ç”¨æˆ·ç»„ä¸‹è¯»å–å­æ–‡ä»¶éœ€è¦è¯¥æ–‡ä»¶å…·å¤‡rçš„æƒé™çš„åŒæ—¶è¿˜éœ€è¦æ‰€æœ‰çˆ¶æ–‡ä»¶å¤¹å…·æœ‰xæƒé™, ä½†åœ¨è¯•ç”¨SDK 24ä»¥ä¸Šä½œä¸ºtargetSdkVersionçš„APPçš„dataç›®å½•åœ¨Nä¸‹éƒ½ä¼šè¢«è®¾ç½®æˆ700æƒé™, å³å…¶ä»–ç”¨æˆ·ç»„æ²¡æ³•è·å–è¯¥dataæ–‡ä»¶å¤¹ä¸‹çš„ä»»ä½•æ–‡ä»¶. ä¸€ä¸ªä¸´æ—¶æ–¹ä¾¿çš„è§£å†³æ–¹æ³•æ˜¯å°†targetSdkVerisonè®¾ç½®æˆ23æˆ–è€…æ›´å°, å¦ä¸€ä¸ªå¯èƒ½å¯è¡Œçš„æ–¹æ³•(æš‚æœªæµ‹è¯•)æ˜¯åœ¨å‰é¢è®¾ç½®SharedPreferenceçš„xmlçš„æƒé™åå°†dataç›®å½•è®¾ç½®Excecutable(<code class="highlighter-rouge">setExecutable</code>).</p> <p>å®Œæ•´çš„è§£å†³æ–¹æ¡ˆå¯ä»¥å‚è€ƒè¿™ä¸ªé¡¹ç›®: <a href="https://github.com/c0ldcat/Hook-Method-Helper">Hook-Method-Helper</a>.</p> <div class="date-highlight"> <!--1--> <a class="tag" href="/tag/xposed">Xposed</a> </div> </div> </div> <script src="/js/canvas.js"></script> <script> (function() { var img = new Image(); function getResult(event) { var imgType = "png"; (event && event.type === 'load' ? img.width == 1 : false) && (imgType = "webp"); $(".block-left").css("background-image", "linear-gradient(rgba(44, 45, 51, 0.8), rgba(44, 45, 51, 0.8)), url(/images/background.png)".replace(/\.png/,"." + imgType)); } img.onerror = getResult; img.onload = getResult; img.src = 'data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA='; })(); </script> </body> </html>
